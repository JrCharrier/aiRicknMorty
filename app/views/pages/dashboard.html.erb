<div class="background-index d-flex flex-column">
  <div class="container mb-5">
    <div class="row align-items-start">
      <h1 class="custom-title text-center pt-5">Dashboard</h1>

      <!-- My Bookings -->
      <div class="col-md-4 mt-5">
        <div class="card shadow">
          <div class="card-header bg-primary text-white">
            <h2><i class="fas fa-book"></i> My Bookings</h2>
          </div>
          <div class="card-body">
            <% if @my_bookings.any? %>
              <ul class="list-unstyled">
                <% @my_bookings.each_with_index do |booking, index| %>
                  <li class="mb-3">
                    <h5>Booking n°<%= index + 1 %></h5>
                    <p><strong>Character:</strong> <%= booking.character.name %></p>
                    <p><strong>Start Date:</strong> <%= booking.start_date %></p>
                    <p><strong>End Date:</strong> <%= booking.end_date %></p>
                    <p><strong>Status:</strong>
                      <% if booking.status == 'approved' %>
                        <span class="badge bg-success">
                          Validated
                        </span>
                      <% elsif booking.status == 'declined' %>
                        <span class="badge bg-danger">Declined</span>
                      <% else %>
                        <span class="badge bg-warning">Pending</span>
                      <% end %>
                    </p>
                    <%= button_to 'Details', character_path(booking.character), method: :get, class: 'btn btn-primary btn-sm' %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p class="text-muted">No bookings found.</p>
            <% end %>
          </div>
        </div>
      </div>

      <!-- My Characters (Sticky column) -->
      <div class="col-md-4 mt-5 sticky-column">
        <div class="card shadow">
          <div class="card-header bg-info text-white">
            <h2><i class="fas fa-users"></i> My Characters</h2>
          </div>
          <div class="card-body">
            <% if @my_characters.any? %>
              <ul class="list-unstyled" style="max-height: 400px; overflow-y: auto;">
                <% @my_characters.each_with_index do |character, index| %>
                  <li class="mb-3 border-bottom">
                    <h5>Character n°<%= index + 1 %></h5>
                    <p><strong>Name:</strong> <%= character.name %></p>
                    <p><strong>Description:</strong> <%= character.description %></p>
                    <p><strong>Gender:</strong> <%= character.gender %></p>
                    <p><strong>Planet:</strong> <%= character.planet %></p>
                    <p><strong>Price:</strong> $<%= character.price %></p>
                    <p><strong>Status:</strong> <%= character.status == false ? 'Available' : character.status %></p>
                    <%= button_to 'Details', character_path(character), method: :get, class: 'btn btn-info btn-sm' %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p class="text-muted">No characters found.</p>
            <% end %>
          </div>
        </div>
      </div>

      <!-- My Pending Reservations -->
      <div class="col-md-4 mt-5">
        <div class="card shadow">
          <div class="card-header bg-warning text-dark">
            <h2><i class="fas fa-calendar-check"></i> Pending reservations</h2>
          </div>
          <div class="card-body">
            <% if @to_be_validated.any? %>
              <ul class="list-unstyled">
                <% @to_be_validated.each_with_index do |booking, index| %>
                  <li class="mb-3">
                    <h5>Booking n°<%= index + 1 %></h5>
                    <p><strong>Character:</strong> <%= booking.character.name %></p>
                    <p><strong>Start Date:</strong> <%= booking.start_date %></p>
                    <p><strong>End Date:</strong> <%= booking.end_date %></p>
                    <p><strong>Customer:</strong> <%= "#{booking.user.first_name} #{booking.user.last_name}" %></p>
                    <p><strong>Status:</strong> <%= booking.status == 'to_be_validated' ? 'Being validated' : booking.status %></p>
                    <%= button_to 'Accept', approve_booking_path(booking), method: :patch, class: 'btn btn-success btn-sm', data: { confirm: 'Do you really want to approve this booking?' } %>
                    <%= button_to 'Decline', decline_booking_path(booking), method: :patch, class: 'btn btn-danger btn-sm', data: { confirm: 'Do you really want to decline this booking?' } %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p class="text-muted">No bookings found.</p>
            <% end %>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
